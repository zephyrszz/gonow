<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoNowVR</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        .page-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
        }

        .page-title {
            font-size: 24px;
            color: #1a1a1a;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e8e8e8;
            font-weight: 500;
        }

        .search-container {
            margin-bottom: 24px;
            padding: 16px;
            background-color: #fafafa;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid #f0f0f0;
        }

        .search-label {
            color: #606266;
            font-size: 14px;
        }

        .table-container {
            margin-top: 16px;
        }

        .link-button {
            color: #1890ff;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .link-button:hover {
            color: #40a9ff;
            text-decoration: none;
        }

        .address-item {
            margin: 6px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .address-label {
            color: #606266;
            font-size: 13px;
        }

        /* 覆盖 Element UI 的默认样式 */
        .el-table {
            border-radius: 6px;
            overflow: hidden;
        }

        .el-table th {
            background-color: #fafafa !important;
            color: #262626;
            font-weight: 500;
        }

        .el-table td {
            color: #595959;
        }

        .el-button--primary {
            background-color: #1890ff;
            border-color: #1890ff;
        }

        .el-button--primary:hover,
        .el-button--primary:focus {
            background-color: #40a9ff;
            border-color: #40a9ff;
        }

        .el-button--primary.is-plain {
            color: #1890ff;
            background: #e6f7ff;
            border-color: #91d5ff;
        }

        .el-button--primary.is-plain:hover,
        .el-button--primary.is-plain:focus {
            background: #1890ff;
            border-color: #1890ff;
            color: #fff;
        }

        .el-input-number {
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="page-container">
            <div class="page-title">GoNowVR</div>
            
            <div class="search-container">
                <!-- <span class="search-label">编号：</span> -->
                <el-input-number 
                    v-model="code" 
                    @change="getList" 
                    :min="1"
                    :controls-position="'right'"
                    size="small"
                    style="width: 160px;"
                    placeholder="请输入编号">
                </el-input-number>
                <el-button 
                    type="primary" 
                    size="small" 
                    icon="el-icon-search"
                    @click="getList">
                    查询
                </el-button>
            </div>
            
            <div class="table-container">
                <el-table 
                    :data="tableData" 
                    border 
                    style="width: 100%"
                    :header-cell-style="{background:'#f5f7fa'}"
                    size="small">
                    <el-table-column prop="contentName" label="名称" max-width="400">
                        <template slot-scope="scope">
                            <span :title="scope.row.contentName">{{ scope.row.contentName }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column label="地址" width="200" align="center">
                        <template slot-scope="scope">
                            <template v-if="scope.row.broadcast8Address">
                                <div 
                                    v-for="(item, index) in scope.row.broadcast8Address" 
                                    :key="index" 
                                    class="address-item"
                                >
                                    <a 
                                        class="link-button"
                                        target="_blank"
                                        :href="item.liveBroadcastSeatAddressList[0].address"
                                    >
                                        {{item.name}}
                                    </a>
                                </div>
                            </template>
                            <template v-else>
                                <el-button 
                                    size="mini" 
                                    type="primary" 
                                    plain
                                    icon="el-icon-download"
                                    @click="getUrl(scope.row, scope.$index)">
                                    获取地址
                                </el-button>
                            </template>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>

    <script>
    new Vue({
        el: '#app',
        data: function() {
            return {
                visible: false,
                code: localStorage.getItem('lastCode') || 2476,
                tableData: [],
                baseURL: 'https://cvrapi.letinvr.com:10443/cmsClient'
            }
        },
        watch: {
            code(newVal) {
                localStorage.setItem('lastCode', newVal)
            }
        },
        mounted() {
            this.getList()
        },
        methods: {
            async getList() {
                try {
                    const response = await fetch(`${this.baseURL}/content/getContentList`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8'
                        },
                        body: JSON.stringify({
                            columnId: this.code,
                            page: 1,
                            size: 1000
                        })
                    })
                    
                    const data = await response.json()
                    if (data.data && data.data.length > 0) {
                        this.tableData = data.data
                    } else {
                        this.tableData = []
                        this.$message.info('没有查询到相关内容')
                    }
                } catch (error) {
                    console.error('获取列表失败:', error)
                    this.$message.error('获取数据失败，请稍后重试')
                    this.tableData = []
                }
            },
            
            async getUrl(element, index) {
                try {
                    const response = await fetch(`${this.baseURL}/content/getContentDetail`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8'
                        },
                        body: JSON.stringify({
                            contentNumber: element.contentNumber,
                            deviceType: 1,
                            contentType: 2
                        })
                    })
                    
                    const data = await response.json()
                    if (data.data) {
                        this.$set(this.tableData[index], 'broadcast8Address', data.data.liveBroadcastSeats)
                    }
                } catch (error) {
                    console.error('获取详情失败:', error)
                    this.$message.error('获取地址失败，请稍后重试')
                }
            }
        }
    })
    </script>
</body>
</html>
